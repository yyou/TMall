<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7"
          crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="style/site.css" rel="stylesheet" />
</head>
<body>
    <div class="shopping-cart-wrapper">
        <div class="shopping-cart">
            <div class="header">
                <span>已选商品（不含运费）</span>
                <span class="total">0.00</span>
                <button class="checkout" href="#nowhere" disabled>结 算</button>
                <div style="clear: both" />
            </div>

            <table class="order-items">
                <thead>
                    <tr>
                        <td><label><input type="checkbox" class="select-all"/> 全选</label></td>
                        <td>商品信息</td>
                        <td>单价</td>
                        <th>数量</th>
                        <th width="120px">金额</th>
                        <th class="operation">操作</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="order-item" oiid="936">
                        <td>
                            <input type="checkbox" class="selection" />                            
                            <img class="product-image" src="img/product-middle/3665.jpg">
                        </td>
                        <td>
                            <div class="product-info">
                                <a class="product-link" href="#nowhere">美国iRobot扫地机器人吸尘器全自动家用智能扫地机650 天猫电器城</a>
                                <div class="product-gurantee">
                                    <img title="支持信用卡支付" src="img/site/creditcard.png">
                                    <img title="消费者保障服务,承诺7天退货" src="img/site/7day.png">
                                    <img title="消费者保障服务,承诺如实描述" src="img/site/promise.png">
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="price price-original">7580.0</div>
                            <div class="price price-current">5306.0</div>
                        </td>
                        <td>
                            <div class="input-group">                                
                                <a href="#nowhere" class="input-group-addon decrease" >-</a>
                                <input value="1" autocomplete="off"  class="form-control text-right quantity" data-stock="5"/>
                                <a href="#nowhere" class="input-group-addon increase">+</a>
                            </div>
                        </td>
                        <td>
                            <span pid="365" oiid="936" class="subtotal" data-subtotal="5306.00">5306.00</span>
                        </td>
                        <td>
                            <a href="#nowhere" oiid="936" class="deleteOrderItem">删除</a>
                        </td>
                    </tr>
                    <tr class="order-item" oiid="935">
                        <td>
                            <input type="checkbox" class="selection"/>
                            <img class="product-image" src="img/product-middle/8510.jpg">
                        </td>
                        <td>
                            <div class="product-info">
                                <a class="product-link" href="#nowhere">阔腿裤三件套装女夏装2016新款大码雪纺时尚休闲气质棉麻九分裤潮</a>
                                <div class="product-gurantee">
                                    <img title="支持信用卡支付" src="img/site/creditcard.png">
                                    <img title="消费者保障服务,承诺7天退货" src="img/site/7day.png">
                                    <img title="消费者保障服务,承诺如实描述" src="img/site/promise.png">
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="price price-original">235.0</div>
                            <div class="price price-current">152.75</div>
                        </td>
                        <td>
                            <div class="cartProductChangeNumberDiv">
                                <div class="input-group">
                                    <a href="#nowhere" class="input-group-addon decrease">-</a>
                                    <input value="1" autocomplete="off" class="form-control text-right quantity" data-stock="99"/>
                                    <a href="#nowhere" class="input-group-addon increase">+</a>
                                </div>
                            </div>
                        </td>
                        <td>
                            <span pid="809" oiid="935" class="subtotal" data-subtotal="152.75">152.75</span>
                        </td>
                        <td>
                            <a href="#nowhere" oiid="935" class="deleteOrderItem">删除</a>
                        </td>
                    </tr>
                </tbody>
            </table>

            <div class="footer">
                <!--<span class="select-all"><label><input type="checkbox" class="select-all" /> 全选</label></span>-->                
                <span class="select-all-wrapper"><label><input type="checkbox" class="select-all" /> 全选</label></span>   
                <div class="summary pull-right">
                    <span>已选商品 <span class="count">0</span> 件</span>
                    <span>合计（不含运费）</span>
                    <span class="total">0.00</span>
                    <button class="checkout" disabled>结  算</button>
                </div>
            </div>
        </div>
    </div>

    <script src="http://code.jquery.com/jquery-2.2.4.js"
            integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI="
            crossorigin="anonymous">
    </script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
            integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
            crossorigin="anonymous">
    </script>

    <script>
        function formatMoney(num) {
            num = num.toString().replace(/\$|\,/g, '');
            if (isNaN(num))
                num = "0";
            sign = (num == (num = Math.abs(num)));
            num = Math.floor(num * 100 + 0.50000000001);
            cents = num % 100;
            num = Math.floor(num / 100).toString();
            if (cents < 10)
                cents = "0" + cents;
            for (var i = 0; i < Math.floor((num.length - (1 + i)) / 3); i++)
                num = num.substring(0, num.length - (4 * i + 3)) + ',' +
                    num.substring(num.length - (4 * i + 3));
            return (((sign) ? '' : '-') + num + '.' + cents);
        }

        function synTotalAmount() {
            var total = 0;
            var subtotal = 0;
            $('input[type=checkbox][class=selection]').each(function () {
                var checked = $(this).is(':checked');
                if (checked) {
                    subtotal = parseFloat(
                        $(this).parents('.order-item').first()
                            .find('.subtotal').first().data('subtotal'));
                    total += subtotal;
                }
            });

            $('.total').text(formatMoney(total));
        }

        function synCheckoutButton() {
            var anySelected = false;
            $('input[type=checkbox][class=selection]').each(function () {
                var checked = $(this).is(':checked');
                if (checked) {
                    anySelected = true;                    
                }
            });
            $('.checkout').prop('disabled', !anySelected);                
        }

        $(function () {
            $('input[type=checkbox][class=selection]').click(function () {                  
                var checked = $(this).is(':checked');
                if (!checked) {
                    $('.select-all').prop('checked', false);
                }

                synTotalAmount();
                synCheckoutButton();
            });

            function quantityChanged(elem) {
                var quantity = parseInt($(elem).val());
                var stock = parseInt($(elem).data('stock'));
                if (isNaN(quantity) || quantity < 0) {
                    quantity = 0;
                } else if (quantity > stock) {
                    quantity = stock;
                }

                $(elem).val(quantity);

                var price = parseFloat(
                    $(elem).parents('.order-item').first()
                        .find('.price-current').first().text());

                //update subtotal
                var subtotal = price * quantity;
                var subtotalElem = $(elem).parents('.order-item').first().find('.subtotal').first();
                subtotalElem.data('subtotal', subtotal).text(formatMoney(subtotal));

                synTotalAmount();
            }

            $('.order-item .quantity').keyup(function () {
                quantityChanged(this);                
            });

            $('.order-item .decrease').click(function () {
                var quantityElem = $(this).parents('.order-item').first().find('.quantity').first();
                var quantity = parseInt(quantityElem.val());
                quantity--;
                quantityElem.val(quantity);

                quantityChanged(quantityElem);
            });

            $('.order-item .increase').click(function () {
                var quantityElem = $(this).parents('.order-item').first().find('.quantity').first();
                var quantity = parseInt(quantityElem.val());
                quantity++;
                quantityElem.val(quantity);

                quantityChanged(quantityElem);
            });

            $('.select-all').click(function () {
                var checked = $(this).is(':checked');
                $('.order-item .selection').prop('checked', checked);
                $('.select-all').prop('checked', checked);                

                synTotalAmount();
                synCheckoutButton();
            });
        });
    </script>
</body>
</html>